<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>簡易チャット</title>
<script type="text/javascript" src="xmlhttp.js"></script>
<script type="text/javascript"><!--
function dataSave()
{
textData = writeData(document.ajaxForm.chatName.value,document.ajaxForm.request.value);
document.ajaxForm.request.value = "";
httpObj = createXMLHttpRequest(displayData);
if (httpObj)
{
httpObj.open("GET","save.rb?request="+encodeURI(textData),true);
httpObj.send(null);
}
}
function displayData()
{
if ((httpObj.readyState == 4) && (httpObj.status == 200))
{
str = httpObj.responseText;
REbr = new RegExp(String.fromCharCode(10),"g");
str = str.replace(REbr,"<br>");
$("result").innerHTML = str;
}
}
//　チャットの時刻、名前、メッセージを設定する
function writeData(uName,sendText)
{
var str = sendText.replace(/&/g,"＆");
var dateObj = new Date(); // 現在の時刻情報を求める
var h = dateObj.getHours(); // 時
var m = dateObj.getMinutes(); // 分
var s = dateObj.getSeconds(); // 秒
if (h < 10) h = "0" + h;
if (m < 10) m = "0" + m;
if (s < 10) s = "0" + s;
return h+":"+m+":"+s+"　["+uName+"] "+str;
}
//　リロードして最新チャットデータを読み込む
function dataReload()
{
httpObj = createXMLHttpRequest(displayData);
if (httpObj)
{
msec = (new Date()).getTime();
httpObj.open("GET","sample.txt?"+msec,true);
httpObj.send(null);
}
setTimeout("dataReload()",1000);
}
// --></script>
</head>
<body onload="dataReload()">
<h1>簡易チャット</h1>
<form method="get" name="ajaxForm" onsubmit="dataSave();return false;">
<input type="text" name="chatName" value="名前" size="8">
<input type="text" name="request" value="試し" size="30"> <input type="submit" value="データを送信"><br>
</form>
<div id="result"></div>
</body>
</html>
